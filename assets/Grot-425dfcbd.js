import{q as n,a5 as l,m as o,w as i,a6 as C,u as V,O as S,aa as T,J as c,ab as I,a9 as h,t as u,I as g,a8 as G,v as p,ac as R,a7 as d}from"./index-2c0f29b7.js";import{a4 as z,a3 as N,m as f,a5 as A}from"./VTextField-9f9fb24f.js";import{p as B,Q as D,q as w,r as y,n as m,o as b,H as k}from"./VRow-58c7a308.js";const F={key:0},L={key:1,class:"rounded ml-3 bg-grey-darken-3"},M={key:3,class:"rounded ml-3 bg-grey-darken-3"},U={class:"d-flex flex-row align-center"},$={class:"mb-4"},v=window.SpeechRecognition||window.webkitSpeechRecognition,r=v?new v:!1,j={created(){window.addEventListener("resize",this.setMobile()),this.setMobile()},beforeDestroy(){r.stop(),r.abort()},data:()=>({lang:"en_US",error:!1,speaking:!1,toggle:!1,micIcon:"mdi-microphone",mobile:!1,loading:!1,theme:"dark",grotApplicationId:"06a226e5-ecb6-4193-8996-aab4460a15e0",grotConversationId:null,grotShow:!0,chat:[],msg:""}),watch:{msg:function(t){if(t==null||t.trim().replace(/\.$/,"").trim()==""){this.msg="";return}else{if(this.loading)return;var e=t.toLowerCase().trim().replace(/\.$/,"").trim();e.endsWith("send")|e.endsWith("sent")&&(this.msg=this.msg.trim(),this.msg=this.msg.split(" ").slice(0,-1).join(" "),this.sendToGrot())}}},methods:{scrollDown(){},endSpeechRecognition(){this.toggle=!1,this.speaking=!1,this.micIcon="mdi-microphone",r.stop(),r.abort()},startSpeechRecognition(){this.toggle=!0,this.micIcon="mdi-microphone-off",r.lang=this.lang,r.continuous=!0,r.interimResults=!1,r.maxAlternatives=1,r.onend=t=>{this.toggle?this.startSpeechRecognition():(this.toggle=!1,this.speaking=!1,this.micIcon="mdi-microphone")},r.onresult=t=>{if(typeof t.results>"u"){r.stop();return}for(var e=t.resultIndex;e<t.results.length;++e)t.results[e].isFinal&t.results[e][0].transcript.trim()!=""&&(this.msg+=this.capitalizeFirstLetter(t.results[e][0].transcript).trim()+". ")};try{r.start()}catch(t){this.toggle=!1,console.log(t)}},capitalizeFirstLetter(t){return t=t.trim(),t.charAt(0).toUpperCase()+t.slice(1)},setMobile(){const t=window.screen.orientation.type;t==="portrait-primary"?this.mobile=!0:t==="landscape-primary"&&(screen.width<=760?this.mobile=!0:this.mobile=!1)},sendToGrot(){this.msg==null||this.msg.trim()==""||(this.loading=!0,this.askGrot(this.msg),this.msg="")},askGrot(t){var e="https://api.pal.ai/v1/conversations",a={applicationId:this.grotApplicationId,conversationId:this.grotConversationId,messageContent:t,isStreaming:!1};this.chat.push({from:"user",msg:a.messageContent}),this.chat.push({from:"grot",msg:"Moment, Grot is thinking..."}),C("askGrot",{source:"user"}),fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(s=>s.json()).then(s=>{this.grotConversationId=s.conversationId,this.chat.pop(),this.chat.push({from:"grot",msg:s.messages[s.messages.length-1].content}),this.loading=!1,this.scrollDown()}).catch(s=>{console.error("Error:",s),this.chat.pop(),this.chat.push({from:"grot",msg:"Error during communication with Grot: "+s}),this.loading=!1})},getCurrentTheme(){return V().global.current.value.dark?"dark":"light"}}},J=Object.assign(j,{__name:"Grot",setup(t){return(e,a)=>(n(),l("div",null,[o(B,{flat:""},{default:i(()=>[o(D,null,{default:i(()=>[e.grotShow?(n(),l("div",F,[o(z,null,{default:i(()=>[o(w,null,{default:i(()=>[o(y,null,{default:i(()=>[(n(!0),l(S,null,T(e.chat,(s,_)=>(n(),l("div",{key:_,class:p(["d-flex flex-row my-2"])},[s.from=="user"?(n(),u(k,{key:0,color:s.from=="user"?"transparent":"red",size:"36"},{default:i(()=>[o(m,{icon:"mdi-account-circle"})]),_:2},1032,["color"])):d("",!0),s.from=="user"?(n(),l("span",L,[o(h(f),{modelValue:s.msg,theme:e.getCurrentTheme(),language:"en-US",toolbars:["code","preview"],footers:[],previewTheme:"github",codeTheme:"github"},null,8,["modelValue","theme"])])):d("",!0),s.from!="user"?(n(),u(k,{key:2,color:s.from=="user"?"indigo":"transparent",image:A,size:"36"},null,8,["color"])):d("",!0),s.from!="user"?(n(),l("span",M,[o(h(f),{modelValue:s.msg,theme:e.getCurrentTheme(),language:"en-US",toolbars:["code","preview"],footers:[],previewTheme:"github",codeTheme:"github"},null,8,["modelValue","theme"])])):d("",!0)]))),128))]),_:1})]),_:1}),o(w,{"no-gutters":""},{default:i(()=>[o(y,null,{default:i(()=>[c("div",U,[o(N,{ref:"chat",modelValue:e.msg,"onUpdate:modelValue":a[0]||(a[0]=s=>e.msg=s),clearable:"",placeholder:"Discuss with Grot",onKeypress:a[1]||(a[1]=I(s=>e.sendToGrot(),["enter"]))},null,8,["modelValue"]),c("div",$,[h(r)?(n(),u(b,{key:0,class:p(["ml-2",{pulse:e.toggle}]),"d-flex":"",onClick:a[2]||(a[2]=R(s=>e.toggle?e.endSpeechRecognition():e.startSpeechRecognition(),["stop"])),icon:"",color:e.toggle?e.speaking?"red lighten-2":"red darken-4":"primary"},{default:i(()=>[o(m,null,{default:i(()=>[g(G(e.micIcon),1)]),_:1})]),_:1},8,["color","class"])):d("",!0),o(b,{icon:"",class:"ml-4",onClick:a[3]||(a[3]=s=>e.sendToGrot()),loading:e.loading,color:"primary"},{default:i(()=>[o(m,null,{default:i(()=>[g("mdi-send")]),_:1})]),_:1},8,["loading"])])])]),_:1})]),_:1})]),_:1})])):d("",!0)]),_:1})]),_:1})]))}});export{J as default};
