import{q as i,a5 as l,m as o,w as r,a6 as C,u as V,O as T,aa as S,J as c,ab as I,a9 as u,t as g,I as h,a8 as G,v as f,ac as R,a7 as d}from"./index-e71ae52d.js";import{a4 as z,a3 as N,m as p,a5 as j}from"./VTextField-f4796673.js";import{p as A,Q as B,q as w,r as v,n as m,o as y,H as _}from"./VRow-7e9f11e3.js";const F={key:0},L={key:0,class:"rounded mr-3 bg-grey-darken-3"},U={key:3,class:"rounded ml-3 bg-grey-darken-3"},$={class:"d-flex flex-row align-center"},D={class:"mb-4"},b=window.SpeechRecognition||window.webkitSpeechRecognition,a=b?new b:!1,E={created(){window.addEventListener("resize",this.setMobile()),this.setMobile()},beforeDestroy(){a.abort()},data:()=>({lang:"en_US",error:!1,speaking:!1,toggle:!1,micIcon:"mdi-microphone",mobile:!1,loading:!1,theme:"dark",grotApplicationId:"06a226e5-ecb6-4193-8996-aab4460a15e0",grotConversationId:null,grotShow:!0,chat:[],msg:""}),watch:{msg:function(s){if(!(s==null||s.trim().replace(/\.$/,"").trim()=="")){if(this.loading)return;var e=s.toLowerCase().replace(/\.$/,"").trim();e.endsWith("send")|e.endsWith("sent")&&(this.msg=this.msg.split(" ").slice(0,-1).join(" "),this.sendToGrot())}}},methods:{scrollDown(){},endSpeechRecognition(){a.stop(),this.toggle=!1,this.speaking=!1,this.micIcon="mdi-microphone"},startSpeechRecognition(){this.toggle=!0,this.micIcon="mdi-microphone-off",a.lang=this.lang,a.continuous=!0,a.interimResults=!1,a.maxAlternatives=1,a.onresult=s=>{if(typeof s.results>"u"){a.stop();return}for(var e=s.resultIndex;e<s.results.length;++e)s.results[e].isFinal&&(this.msg+=this.capitalizeFirstLetter(s.results[e][0].transcript))},a.start()},capitalizeFirstLetter(s){return s.charAt(0).toUpperCase()+s.slice(1)},setMobile(){const s=window.screen.orientation.type;s==="portrait-primary"?this.mobile=!0:s==="landscape-primary"&&(screen.width<=760?this.mobile=!0:this.mobile=!1)},sendToGrot(){this.msg==null||this.msg==""||(this.loading=!0,this.askGrot(this.msg),this.msg="")},askGrot(s){var e="https://api.pal.ai/v1/conversations",n={applicationId:this.grotApplicationId,conversationId:this.grotConversationId,messageContent:s,isStreaming:!1};this.chat.push({from:"user",msg:n.messageContent}),C("askGrot",{source:"user"}),fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(t=>t.json()).then(t=>{this.grotConversationId=t.conversationId,this.chat.push({from:"grot",msg:t.messages[t.messages.length-1].content}),this.loading=!1,this.scrollDown()}).catch(t=>{console.error("Error:",t),this.chat.push({from:"grot",msg:"Error during communication with Grot: "+t}),this.loading=!1})},getCurrentTheme(){return V().global.current.value.dark?"dark":"light"}}},q=Object.assign(E,{__name:"Grot",setup(s){return(e,n)=>(i(),l("div",null,[o(A,{flat:""},{default:r(()=>[o(B,null,{default:r(()=>[e.grotShow?(i(),l("div",F,[o(z,null,{default:r(()=>[o(w,null,{default:r(()=>[o(v,null,{default:r(()=>[(i(!0),l(T,null,S(e.chat,(t,k)=>(i(),l("div",{key:k,class:f(["d-flex flex-row align-center my-2",t.from=="user"?"justify-end":null])},[t.from=="user"?(i(),l("span",L,[o(u(p),{modelValue:t.msg,theme:e.getCurrentTheme(),language:"en-US",toolbars:["code","preview"],footers:[],previewTheme:"github",codeTheme:"github"},null,8,["modelValue","theme"])])):d("",!0),t.from=="user"?(i(),g(_,{key:1,color:t.from=="user"?"transparent":"red",size:"36"},{default:r(()=>[o(m,{icon:"mdi-account-circle"})]),_:2},1032,["color"])):d("",!0),t.from!="user"?(i(),g(_,{key:2,color:t.from=="user"?"indigo":"transparent",image:j,size:"36"},null,8,["color"])):d("",!0),t.from!="user"?(i(),l("span",U,[o(u(p),{modelValue:t.msg,theme:e.getCurrentTheme(),language:"en-US",toolbars:["code","preview"],footers:[],previewTheme:"github",codeTheme:"github"},null,8,["modelValue","theme"])])):d("",!0)],2))),128))]),_:1})]),_:1}),o(w,{"no-gutters":""},{default:r(()=>[o(v,null,{default:r(()=>[c("div",$,[o(N,{ref:"chat",modelValue:e.msg,"onUpdate:modelValue":n[0]||(n[0]=t=>e.msg=t),placeholder:"Write response to Grot",onKeypress:n[1]||(n[1]=I(t=>e.sendToGrot(),["enter"]))},null,8,["modelValue"]),c("div",D,[u(a)?(i(),g(y,{key:0,class:f(["ml-2",{pulse:e.toggle}]),"d-flex":"",onClick:n[2]||(n[2]=R(t=>e.toggle?e.endSpeechRecognition():e.startSpeechRecognition(),["stop"])),icon:"",color:e.toggle?e.speaking?"red lighten-2":"red darken-4":"primary"},{default:r(()=>[o(m,null,{default:r(()=>[h(G(e.micIcon),1)]),_:1})]),_:1},8,["color","class"])):d("",!0),o(y,{icon:"",class:"ml-4",onClick:n[3]||(n[3]=t=>e.sendToGrot()),loading:e.loading},{default:r(()=>[o(m,null,{default:r(()=>[h("mdi-send")]),_:1})]),_:1},8,["loading"])])])]),_:1})]),_:1})]),_:1})])):d("",!0)]),_:1})]),_:1})]))}});export{q as default};
